import pandas as pd
import numpy as np
pd.set_option('display.max_rows', 100)

data = [
    ['1691632500000', '29575.5', '29589', '29561', '29588.5', '348.259', '10299598.9805'], ['1691632800000', '29588.5', '29589.5', '29579', '29580', '291.033', '8610408.9145'], ['1691633100000', '29580', '29607', '29580', '29604', '320.307', '9479156.4485'], ['1691633400000', '29604', '29622.5', '29602.5', '29620', '285.468', '8452870.023'], ['1691633700000', '29620', '29623', '29605.5', '29606', '285.679', '8461446.4415'], ['1691634000000', '29606', '29606', '29585', '29585.5', '256.276', '7583923.813'], ['1691634300000', '29585.5', '29600.5', '29584.5', '29596.5', '159.575', '4722206.8645'], ['1691634600000', '29596.5', '29602.5', '29589', '29602', '331.389', '9807183.654'], ['1691634900000', '29602', '29605', '29602', '29605', '380.436', '11261908.3295'], ['1691635200000', '29605', '29605.5', '29603', '29603.5', '326.99', '9680158.8745'], ['1691635500000', '29603.5', '29613.5', '29603', '29610.5', '382.091', '11313602.907'], ['1691635800000', '29610.5', '29610.5', '29579.5', '29579.5', '376.703', '11145519.512'], ['1691636100000', '29579.5', '29580', '29562', '29562.5', '403.516', '11932114.8295'], ['1691636400000', '29562.5', '29563', '29555', '29555', '481.439', '14231361.2205'], ['1691636700000', '29555', '29560.5', '29554', '29560.5', '479.179', '14163099.2325'], ['1691637000000', '29560.5', '29577', '29560', '29575', '348.14', '10294097.371'], ['1691637300000', '29575', '29591.5', '29574', '29590', '418.27', '12373705.3155'], ['1691637600000', '29590', '29592.5', '29589.5', '29591', '353.551', '10462165.248'], ['1691637900000', '29591', '29591.5', '29573.5', '29575.5', '300.634', '8891906.32'], ['1691638200000', '29575.5', '29575.5', '29554.5', '29554.5', '326.75', '9659098.344'], ['1691638500000', '29554.5', '29559', '29551', '29558.5', '291.189', '8606019.0855'], ['1691638800000', '29558.5', '29565', '29558', '29564.5', '208.342', '6159337.152'], ['1691639100000', '29564.5', '29565.5', '29560', '29561.5', '321.805', '9513673.516'], ['1691639400000', '29561.5', '29567', '29560.5', '29566.5', '233.584', '6905468.0375'], ['1691639700000', '29566.5', '29568', '29562', '29562', '290.988', '8603094.673'], ['1691640000000', '29562', '29562.5', '29559.5', '29560.5', '263.498', '7789397.9865'], ['1691640300000', '29560.5', '29560.5', '29548.5', '29549.5', '337.665', '9978799.4145'], ['1691640600000', '29549.5', '29550.5', '29536', '29545', '245.997', '7268621.334'], ['1691640900000', '29545', '29546.5', '29532', '29535.5', '268.466', '7931105.336'], ['1691641200000', '29535.5', '29535.5', '29523.5', '29531', '319.789', '9443439.8'], ['1691641500000', '29531', '29534', '29529', '29531', '286.547', '8462133.05'], ['1691641800000', '29531', '29538.5', '29525.5', '29535.5', '287.4', '8487358.848'], ['1691642100000', '29535.5', '29544', '29535.5', '29535.5', '214.967', '6349954.3795'], ['1691642400000', '29535.5', '29540', '29530', '29539.5', '203.024', '5996136.5915'], ['1691642700000', '29539.5', '29548', '29539.5', '29540.5', '159.859', '4722428.2405'], ['1691643000000', '29540.5', '29541', '29529.5', '29531.5', '161.152', '4759151.864'], ['1691643300000', '29531.5', '29533', '29528.5', '29529', '121.901', '3599840.1515'], ['1691643600000', '29529', '29533', '29524', '29524.5', '201.311', '5944483.1395'], ['1691643900000', '29524.5', '29525', '29505.5', '29508.5', '308.534', '9106125.548'], ['1691644200000', '29508.5', '29510', '29498', '29506.5', '298.434', '8805346.624'], ['1691644500000', '29506.5', '29506.5', '29497', '29502.5', '313.831', '9258659.9695'], ['1691644800000', '29502.5', '29509', '29502', '29507.5', '223.922', '6606835.447'], ['1691645100000', '29507.5', '29508.5', '29501.5', '29503', '179.482', '5295524.1705'], ['1691645400000', '29503', '29513.5', '29500', '29513', '215.286', '6352161.1545'], ['1691645700000', '29513', '29519.5', '29512.5', '29516.5', '232.207', '6853706.956'], ['1691646000000', '29516.5', '29524', '29514.5', '29521.5', '173.861', '5132384.528'], ['1691646300000', '29521.5', '29544.5', '29521.5', '29544', '238.814', '7054391.275'], ['1691646600000', '29544', '29555', '29543.5', '29555', '346.036', '10225691.553'], ['1691646900000', '29555', '29600', '29554.5', '29571', '517.452', '15305730.4635'], ['1691647200000', '29571', '29597', '29568.5', '29590', '405.008', '11982314.9365'], ['1691647500000', '29590', '29590', '29569.5', '29571', '221.691', '6556869.5925'], ['1691647800000', '29571', '29571.5', '29552.5', '29555.5', '206.219', '6096869.158'], ['1691648100000', '29555.5', '29560', '29517.5', '29520', '290.595', '8584999.925'], ['1691648400000', '29520', '29524', '29514', '29515.5', '176.777', '5218219.224'], ['1691648700000', '29515.5', '29526.5', '29515', '29526', '173.527', '5123132.061'], ['1691649000000', '29526', '29538', '29525.5', '29538', '355.493', '10499138.999'], ['1691649300000', '29538', '29540', '29534.5', '29538', '133.642', '3947411.1975'], ['1691649600000', '29538', '29541', '29520.5', '29522', '276.422', '8164260.6825'], ['1691649900000', '29522', '29524.5', '29502', '29507.5', '422.014', '12453263.7055'], ['1691650200000', '29507.5', '29508', '29498', '29498.5', '298.403', '8803467.207'], ['1691650500000', '29498.5', '29499', '29495', '29496.5', '349.813', '10318560.2035'], ['1691650800000', '29496.5', '29514.5', '29495.5', '29514.5', '302.065', '8912257.5185'], ['1691651100000', '29514.5', '29528', '29514', '29528', '219.247', '6472604.428'], ['1691651400000', '29528', '29530', '29527.5', '29530', '305.764', '9028981.577'], ['1691651700000', '29530', '29550', '29530', '29545.5', '280.55', '8288538.4055'], ['1691652000000', '29545.5', '29546.5', '29536.5', '29546.5', '239.785', '7084173.5925'], ['1691652300000', '29546.5', '29550', '29546', '29549', '259.337', '7662699.9805'], ['1691652600000', '29549', '29550.5', '29546', '29546.5', '217.456', '6425661.0365'], ['1691652900000', '29546.5', '29546.5', '29510', '29510', '292.302', '8631323.015'], ['1691653200000', '29510', '29510.5', '29500.5', '29501.5', '397.61', '11731226.7425'], ['1691653500000', '29501.5', '29501.5', '29475', '29482.5', '537.152', '15838971.57'], ['1691653800000', '29482.5', '29487.5', '29482', '29487', '305.772', '9016225.952'], ['1691654100000', '29487', '29497.5', '29484', '29497.5', '408.427', '12043197.3535'], ['1691654400000', '29497.5', '29512', '29496.5', '29512', '286.105', '8441076.7495'], ['1691654700000', '29512', '29522', '29508.5', '29508.5', '327.68', '9672486.686'], ['1691655000000', '29508.5', '29510', '29497', '29498.5', '310.977', '9175101.115'], ['1691655300000', '29498.5', '29500.5', '29480.5', '29485', '300.102', '8851612.3925'], ['1691655600000', '29485', '29493.5', '29484.5', '29491.5', '190.099', '5605914.218'], ['1691655900000', '29491.5', '29499', '29484.5', '29499', '219.736', '6479943.879'], ['1691656200000', '29499', '29504.5', '29492', '29492.5', '184.61', '5446289.6755'], ['1691656500000', '29492.5', '29495.5', '29491', '29495.5', '165.935', '4893851.845'], ['1691656800000', '29495.5', '29498', '29495', '29497.5', '189.803', '5598656.446'], ['1691657100000', '29497.5', '29497.5', '29491', '29494.5', '252.821', '7456589.2405'], ['1691657400000', '29494.5', '29504', '29494.5', '29503.5', '240.779', '7102426.9765'], ['1691657700000', '29503.5', '29504.5', '29499', '29501', '200.399', '5912212.0375'], ['1691658000000', '29501', '29501', '29498.5', '29499', '168.236', '4962952.7235'], ['1691658300000', '29499', '29501.5', '29498.5', '29501.5', '245.741', '7249486.2635'], ['1691658600000', '29501.5', '29501.5', '29497', '29498', '223.203', '6584490.687'], ['1691658900000', '29498', '29498', '29485', '29486', '275.927', '8137451.017'], ['1691659200000', '29486', '29486', '29477', '29479', '224.908', '6630450.252'], ['1691659500000', '29479', '29482', '29477', '29477.5', '262.056', '7725196.6865'], ['1691659800000', '29477.5', '29482', '29467.5', '29469.5', '323.064', '9521741.1065'], ['1691660100000', '29469.5', '29472', '29458', '29471', '425.419', '12536532.794'], ['1691660400000', '29471', '29520.5', '29470.5', '29520.5', '526.148', '15520958.892'], ['1691660700000', '29520.5', '29539', '29508', '29521', '602.14', '17777730.667'], ['1691661000000', '29521', '29521.5', '29512', '29513.5', '280.271', '8272150.61'], ['1691661300000', '29513.5', '29516.5', '29511.5', '29514.5', '266.356', '7861103.5765'], ['1691661600000', '29514.5', '29532', '29514.5', '29531', '287.921', '8501659.736'], ['1691661900000', '29531', '29531', '29509.5', '29510', '269.552', '7956346.861'], ['1691662200000', '29510', '29510', '29507', '29507', '137.856', '4067928.4525']
    # ... (other data rows)
]

# Define column names
columns = ['timestamp', 'open', 'high', 'low', 'close', 'volume', 'turnover']

# Create a DataFrame from the data
df = pd.DataFrame(data, columns=columns)

# Convert timestamp column to datetime
df['timestamp'] = pd.to_datetime(df['timestamp'], unit='ms')

# Convert numeric columns to appropriate data types
df[['open', 'high', 'low', 'close', 'volume', 'turnover']] = df[['open', 'high', 'low', 'close', 'volume', 'turnover']].apply(pd.to_numeric)

# Calculate sv
df['sv'] = np.where(df['close'] - (df['high'] + df['low'] + df['close']) / 3 >= 0, df['volume'], -df['volume'])

# Calculate kvo
df['kvo'] = df['sv'].ewm(span=34).mean() - df['sv'].ewm(span=55).mean()

# Calculate sig
df['sig'] = df['kvo'].ewm(span=13).mean()

# Calculate lsma
length = 27
weights = np.arange(1, length + 1)
weights = weights * 2 - 1
weights = weights[::-1]
weights = weights / np.sum(weights)
df['lsma'] = df['close'].rolling(window=length).apply(lambda x: np.dot(x, weights), raw=True)
print(df)
